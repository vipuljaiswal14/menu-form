<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sankalp Manowara Wedding Reception Menu - Veg Gold Selection</title>
  <style>
    :root { --border:#e5e7eb; --text:#111827; --muted:#6b7280; --bg:#ffffff; --chip:#eef2ff; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color:var(--text); background:#f8fafc; }
    .wrap { max-width: 1100px; margin: 24px auto; padding: 0 16px 28px; }
    .card { background:var(--bg); border:1px solid var(--border); border-radius:14px; box-shadow: 0 1px 3px rgba(0,0,0,.04); }
    header.card { padding:16px 16px 12px; }
    h1 { font-size: 18px; margin:0 0 6px; }
    .meta { color:var(--muted); font-size: 13px; line-height: 1.4; }
    .actions { display:flex; flex-wrap:wrap; gap:10px; margin-top:12px; align-items:center; }
    button, .btn {
      border: 1px solid var(--border);
      background:#fff;
      color:var(--text);
      border-radius:10px;
      padding:10px 12px;
      font-size: 13px;
      cursor:pointer;
    }
    button:hover { background:#f9fafb; }
    .btn-primary { background:#111827; color:#fff; border-color:#111827; }
    .btn-primary:hover { background:#0b1220; }
    .pill { display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border:1px solid var(--border); border-radius:999px; font-size:12px; color:var(--muted); background:#fff; }
    .pill strong { color:var(--text); }
    .table-wrap { overflow:auto; border-top:1px solid var(--border); border-bottom-left-radius:14px; border-bottom-right-radius:14px; }
    table { width:100%; border-collapse: collapse; min-width: 980px; }
    thead th {
      position: sticky; top: 0;
      background:#f9fafb;
      border-bottom:1px solid var(--border);
      text-align:left;
      font-size: 12px;
      color: var(--muted);
      padding:10px 12px;
      z-index:1;
    }
    tbody td { border-bottom:1px solid var(--border); padding:10px 12px; vertical-align: top; font-size: 13px; }
    tbody tr:last-child td { border-bottom:none; }
    .cat { color: var(--muted); font-weight: 650; white-space: nowrap; }
    .dish { display:flex; align-items:flex-start; gap:8px; }
    .lko { font-size: 11px; padding:2px 8px; border-radius:999px; background:var(--chip); border:1px solid #c7d2fe; color:#3730a3; font-weight:700; }
    .muted { color: var(--muted); font-size: 12px; }
    .score { font-variant-numeric: tabular-nums; }
    .center { text-align:center; }
    input[type="checkbox"] { width: 18px; height: 18px; cursor:pointer; }
    .footer { padding: 14px 16px; border-top:1px solid var(--border); display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
    .note { color:var(--muted); font-size: 12px; }
    .grid { display:grid; gap:10px; grid-template-columns: 1fr; margin-top:12px; }
    .panel { border:1px solid var(--border); background:#fff; border-radius:12px; padding:12px; }
    .row { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .field { display:flex; flex-direction:column; gap:6px; min-width: 240px; flex: 1 1 260px; }
    .field label { font-size: 12px; color:var(--muted); }
    .field input, .field select {
      border:1px solid var(--border); border-radius:10px; padding:10px 12px; font-size:13px;
      outline:none;
    }
    .linkbox { display:flex; gap:10px; align-items:center; background:#fff; border:1px solid var(--border); border-radius: 12px; padding:10px 12px; }
    .linkbox input { flex:1; border:none; outline:none; font-size: 12px; color:#111827; }
  </style>
</head>

<body>
  <div class="wrap">
    <header class="card">
      <h1>Sankalp Manowara Wedding Reception Menu - Veg Gold Selection</h1>
      <div class="meta">
        Venue: Holiday Inn Lucknow Airport (IHG) · Winter evening · Guests ~200 · <span class="lko">LKO</span> = Lucknow speciality
      </div>

      <div class="grid">
        <div class="panel">
          <div class="row">
            <div class="field">
              <label for="familyMember">Family member name (required)</label>
              <input id="familyMember" type="text" placeholder="e.g., Vipul / Ajay / Vijay / Mayank / Atharv" />
            </div>
            <div class="field">
              <label for="roleHint">Role (optional)</label>
              <select id="roleHint">
                <option value="">— Select (optional)</option>
                <option>Host family</option>
                <option>Elder (menu approval)</option>
                <option>Younger (taste preference)</option>
                <option>Outstation perspective</option>
              </select>
            </div>

            <span class="pill"><strong id="selCount">0</strong> dishes selected</span>
            <span class="pill"><strong id="hotelCount">0</strong> hotel-recommended</span>
          </div>

          <div class="actions">
            <button class="btn-primary" id="submitBtn">Submit (Generate share link + download)</button>
            <button id="downloadJson">Download response (JSON)</button>
            <button id="copyShare">Copy share link</button>
            <button id="clearAll">Clear all</button>
          </div>

          <div class="actions" style="margin-top:10px;">
            <div class="linkbox" title="Share this link with family. It includes name + selections in the URL.">
              <span class="muted">Shareable link:</span>
              <input id="shareUrl" readonly value="" />
              <button id="copyShare2">Copy</button>
            </div>
            <div class="note">
              Note: GitHub Pages is static. “Submit” creates a share-link and a file to send back. If you want automatic recording to a sheet, tell me and I’ll convert Submit to save into Google Sheets.
            </div>
          </div>
        </div>
      </div>
    </header>

    <div class="card table-wrap">
      <table>
        <thead>
          <tr>
            <th style="width: 260px;">Category (How many to select)</th>
            <th>Dish</th>
            <th style="width: 110px;" class="center">Selected</th>
            <th style="width: 170px;" class="center">Hotel ✔</th>
            <th style="width: 150px;">Popularity (/5)</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>

      <div class="footer">
        <div class="note">
          Popularity score is a practical crowd-acceptance estimate for North Indian wedding banquets (not online ratings).
        </div>
      </div>
    </div>
  </div>

  <script>
    // ---- Category rules to display "how many to select" in Category column ----
    const categoryRules = {
      "Welcome Drink": "Select 1",
      "Vegetarian Appetizers – Paneer": "Select 2 (within Starters)",
      "Vegetarian Appetizers – Veg / Awadhi": "Select 1 (within Starters)",
      "Vegetarian Appetizers – Fusion": "Select 1 (within Starters)",
      "Soup": "Select 1",
      "Salads": "Select 3",
      "Main Course – Paneer": "Select 1 (within Mains)",
      "Main Course – Festive Gravy": "Select 1 (within Mains)",
      "Main Course – Seasonal Vegetable": "Select 1 (within Mains)",
      "Lentil / Dal": "Select 1",
      "Rice Preparation": "Select 1",
      "Yogurt Preparation": "Select 1",
      "Indian Breads": "Select any 3",
      "Indian Dessert": "Select 1",
      "Western Dessert": "Select 1",
      "Ice Cream": "Select 1"
    };

    // ---- Dishes ----
    const rows = [
      { section: "Welcome Drink", dish: "Kesar Badam Milk (Warm)", lko:true, score: 4.6 },
      { section: "Welcome Drink", dish: "Hot Aam Panna", score: 4.2 },
      { section: "Welcome Drink", dish: "Strawberry Milk", score: 4.0 },
      { section: "Welcome Drink", dish: "Jaljeera (Mild)", score: 4.1 },

      { section: "Vegetarian Appetizers – Paneer", dish: "Paneer Malai Tikka", score: 4.6 },
      { section: "Vegetarian Appetizers – Paneer", dish: "Paneer Amritsari", score: 4.5 },
      { section: "Vegetarian Appetizers – Paneer", dish: "Paneer Kurkura", score: 4.4 },
      { section: "Vegetarian Appetizers – Paneer", dish: "Achari Paneer Tikka", score: 4.3 },

      { section: "Vegetarian Appetizers – Veg / Awadhi", dish: "Veg Galouti Kebab", lko:true, score: 4.4 },
      { section: "Vegetarian Appetizers – Veg / Awadhi", dish: "Hara Bhara Kebab", score: 4.3 },
      { section: "Vegetarian Appetizers – Veg / Awadhi", dish: "Dahi ke Kebab", score: 4.2 },

      { section: "Vegetarian Appetizers – Fusion", dish: "Corn Cheese Balls", score: 4.6 },
      { section: "Vegetarian Appetizers – Fusion", dish: "Cheese & Jalapeño Pockets", score: 4.5 },
      { section: "Vegetarian Appetizers – Fusion", dish: "Veg Spring Rolls", score: 4.4 },
      { section: "Vegetarian Appetizers – Fusion", dish: "Honey Chilli Potato", score: 4.5 },

      { section: "Soup", dish: "Sweet Corn Vegetable Soup", score: 4.4 },
      { section: "Soup", dish: "Tomato Dhaniya Shorba", score: 4.3 },
      { section: "Soup", dish: "Cream of Mushroom Soup", score: 4.1 },

      { section: "Salads", dish: "Green Salad", score: 4.2 },
      { section: "Salads", dish: "Russian / Waldorf Salad", score: 4.3 },
      { section: "Salads", dish: "Fruit Chaat", score: 4.4 },
      { section: "Salads", dish: "Pasta Salad", score: 4.1 },
      { section: "Salads", dish: "Sprout Salad", score: 3.9 },

      { section: "Main Course – Paneer", dish: "Paneer Butter Masala", score: 4.8 },
      { section: "Main Course – Paneer", dish: "Paneer Lababdar", score: 4.7 },
      { section: "Main Course – Paneer", dish: "Shahi Paneer", score: 4.6 },

      { section: "Main Course – Festive Gravy", dish: "Malai Kofta", score: 4.7 },
      { section: "Main Course – Festive Gravy", dish: "Navratan Korma", score: 4.6 },
      { section: "Main Course – Festive Gravy", dish: "Kaju Curry", score: 4.5 },

      { section: "Main Course – Seasonal Vegetable", dish: "Dum Aloo Banarasi", lko:true, score: 4.5 },
      { section: "Main Course – Seasonal Vegetable", dish: "Mix Veg Handi", score: 4.3 },
      { section: "Main Course – Seasonal Vegetable", dish: "Aloo Mutter", score: 4.2 },
      { section: "Main Course – Seasonal Vegetable", dish: "Seasonal Veg Curry", score: 4.1 },

      { section: "Lentil / Dal", dish: "Dal Makhani", score: 4.9 },
      { section: "Lentil / Dal", dish: "Dal Panchmel", score: 4.4 },
      { section: "Lentil / Dal", dish: "Dal Tadka", score: 4.3 },

      { section: "Rice Preparation", dish: "Veg Pulao", score: 4.4 },
      { section: "Rice Preparation", dish: "Peas Pulao", score: 4.3 },
      { section: "Rice Preparation", dish: "Jeera Rice", score: 4.2 },

      { section: "Yogurt Preparation", dish: "Boondi Raita", score: 4.3 },
      { section: "Yogurt Preparation", dish: "Mix Veg Raita", score: 4.2 },
      { section: "Yogurt Preparation", dish: "Pineapple Raita", score: 4.0 },

      { section: "Indian Breads", dish: "Butter Naan", score: 4.8 },
      { section: "Indian Breads", dish: "Plain Roti", score: 4.6 },
      { section: "Indian Breads", dish: "Laccha Paratha", score: 4.7 },
      { section: "Indian Breads", dish: "Missi Roti", lko:true, score: 4.5 },
      { section: "Indian Breads", dish: "Garlic Naan", score: 4.6 },

      { section: "Indian Dessert", dish: "Gajar ka Halwa (Hot)", lko:true, score: 4.9 },
      { section: "Indian Dessert", dish: "Gulab Jamun", score: 4.8 },
      { section: "Indian Dessert", dish: "Moong Dal Halwa", score: 4.6 },

      { section: "Western Dessert", dish: "Chocolate Truffle Pastry", score: 4.3 },
      { section: "Western Dessert", dish: "Brownie with Chocolate Sauce", score: 4.4 },
      { section: "Western Dessert", dish: "Red Velvet Pastry", score: 4.2 },

      { section: "Ice Cream", dish: "Vanilla", score: 4.3 },
      { section: "Ice Cream", dish: "Strawberry", score: 4.1 },
      { section: "Ice Cream", dish: "Kesar Pista", score: 4.2 },
    ];

    // ---- State ----
    // {id: {selected:boolean, hotel:boolean}}
    const state = {};

    const tbody = document.getElementById("tbody");
    const selCountEl = document.getElementById("selCount");
    const hotelCountEl = document.getElementById("hotelCount");
    const shareUrlEl = document.getElementById("shareUrl");
    const nameEl = document.getElementById("familyMember");
    const roleEl = document.getElementById("roleHint");

    const makeId = (s) => s.toLowerCase().replace(/[^a-z0-9]+/g, "-").replace(/(^-|-$)/g, "");

    function initState() {
      rows.forEach(r => {
        const id = makeId(r.section + "-" + r.dish);
        if (!state[id]) state[id] = { selected:false, hotel:false };
      });
    }

    function categoryLabel(section) {
      const rule = categoryRules[section] ? ` · ${categoryRules[section]}` : "";
      return `${section}${rule}`;
    }

    function render() {
      tbody.innerHTML = "";
      let lastSection = null;

      rows.forEach(r => {
        const id = makeId(r.section + "-" + r.dish);
        const st = state[id];

        const tr = document.createElement("tr");

        const tdCat = document.createElement("td");
        tdCat.className = "cat";
        tdCat.textContent = (r.section !== lastSection) ? categoryLabel(r.section) : "";
        lastSection = r.section;

        const tdDish = document.createElement("td");
        tdDish.innerHTML = `${escapeHtml(r.dish)} ${r.lko ? '<span class="lko">LKO</span>' : ''}`;

        const tdSel = document.createElement("td");
        tdSel.className = "center";
        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.checked = !!st.selected;
        cb.addEventListener("change", () => {
          st.selected = cb.checked;
          persistToUrl();
          updateStatsAndShare();
        });
        tdSel.appendChild(cb);

        // Hotel recommendation as simple checkbox (your request #3)
        const tdHotel = document.createElement("td");
        tdHotel.className = "center";
        const hb = document.createElement("input");
        hb.type = "checkbox";
        hb.checked = !!st.hotel;
        hb.addEventListener("change", () => {
          st.hotel = hb.checked;
          persistToUrl();
          updateStatsAndShare();
        });
        tdHotel.appendChild(hb);

        const tdScore = document.createElement("td");
        tdScore.className = "score";
        tdScore.textContent = r.score.toFixed(1);

        tr.appendChild(tdCat);
        tr.appendChild(tdDish);
        tr.appendChild(tdSel);
        tr.appendChild(tdHotel);
        tr.appendChild(tdScore);

        tbody.appendChild(tr);
      });

      updateStatsAndShare();
    }

    function updateStatsAndShare() {
      const ids = Object.keys(state);
      const selectedCount = ids.reduce((a, id) => a + (state[id].selected ? 1 : 0), 0);
      const hotelCount = ids.reduce((a, id) => a + (state[id].hotel ? 1 : 0), 0);
      selCountEl.textContent = selectedCount;
      hotelCountEl.textContent = hotelCount;
      shareUrlEl.value = buildShareUrl();
    }

    // ---- URL share encoding (name + only changes) ----
    function persistToUrl() {
      const payload = {
        name: nameEl.value.trim(),
        role: roleEl.value || "",
        items: {}
      };

      Object.entries(state).forEach(([id, st]) => {
        if (st.selected || st.hotel) payload.items[id] = st;
      });

      const encoded = btoa(unescape(encodeURIComponent(JSON.stringify(payload))));
      const url = new URL(window.location.href);
      if (payload.name || Object.keys(payload.items).length) url.searchParams.set("s", encoded);
      else url.searchParams.delete("s");
      history.replaceState(null, "", url.toString());
    }

    function buildShareUrl() {
      return window.location.href;
    }

    function loadFromUrl() {
      const url = new URL(window.location.href);
      const s = url.searchParams.get("s");
      if (!s) return;
      try {
        const json = decodeURIComponent(escape(atob(s)));
        const payload = JSON.parse(json);

        if (payload?.name) nameEl.value = payload.name;
        if (payload?.role) roleEl.value = payload.role;

        const items = payload?.items || {};
        Object.entries(items).forEach(([id, st]) => {
          if (state[id]) {
            state[id].selected = !!st.selected;
            state[id].hotel = !!st.hotel;
          }
        });
      } catch (e) {}
    }

    // ---- Submit behavior (Option A: generate a file + share message) ----
    function getResponseObject() {
      const name = nameEl.value.trim();
      const role = roleEl.value || "";
      const selections = rows.map(r => {
        const id = makeId(r.section + "-" + r.dish);
        const st = state[id];
        return {
          category: r.section,
          dish: r.dish,
          lko: !!r.lko,
          popularity: r.score,
          selected: !!st.selected,
          hotelRecommended: !!st.hotel
        };
      }).filter(x => x.selected || x.hotelRecommended);

      return {
        title: "Sankalp Manowara Wedding Reception Menu - Veg Gold Selection",
        venue: "Holiday Inn Lucknow Airport (IHG)",
        submittedBy: name,
        role,
        submittedAt: new Date().toISOString(),
        responseLink: buildShareUrl(),
        items: selections
      };
    }

    function downloadAsJson(obj, filename) {
      const blob = new Blob([JSON.stringify(obj, null, 2)], { type: "application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = filename;
      a.click();
      URL.revokeObjectURL(a.href);
    }

    function escapeHtml(str) {
      return String(str).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
        .replaceAll('"',"&quot;").replaceAll("'","&#039;");
    }

    async function copyText(text) {
      try {
        await navigator.clipboard.writeText(text);
        alert("Copied to clipboard.");
      } catch {
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
        alert("Copied to clipboard.");
      }
    }

    // ---- Button wiring ----
    document.getElementById("copyShare").addEventListener("click", () => copyText(buildShareUrl()));
    document.getElementById("copyShare2").addEventListener("click", () => copyText(buildShareUrl()));

    document.getElementById("downloadJson").addEventListener("click", () => {
      const name = nameEl.value.trim() || "family-member";
      downloadAsJson(getResponseObject(), `menu-response-${name.replace(/\s+/g,"-").toLowerCase()}.json`);
    });

    document.getElementById("submitBtn").addEventListener("click", () => {
      const name = nameEl.value.trim();
      if (!name) {
        alert("Please enter family member name before submitting.");
        nameEl.focus();
        return;
      }
      persistToUrl();

      const resp = getResponseObject();
      downloadAsJson(resp, `menu-response-${name.replace(/\s+/g,"-").toLowerCase()}.json`);

      // WhatsApp-friendly message (user can paste)
      const msg =
        `Menu selection submitted by: ${name}\n` +
        `Link: ${resp.responseLink}\n` +
        `Selected/Marked items: ${resp.items.length}\n\n` +
        `Please open the link to view my selections.`;
      copyText(msg);
      alert("Submitted. A JSON file was downloaded and a WhatsApp-ready message was copied to clipboard.");
    });

    document.getElementById("clearAll").addEventListener("click", () => {
      if (!confirm("Clear all selections and hotel ticks?")) return;
      Object.keys(state).forEach(id => { state[id].selected = false; state[id].hotel = false; });
      persistToUrl();
      render();
    });

    // Persist on name/role change
    nameEl.addEventListener("input", () => { persistToUrl(); updateStatsAndShare(); });
    roleEl.addEventListener("change", () => { persistToUrl(); updateStatsAndShare(); });

    // ---- Boot ----
    initState();
    loadFromUrl();
    render();
    persistToUrl();
  </script>
</body>
</html>

